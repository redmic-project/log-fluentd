<system>
	log_level "#{ENV['LOG_LEVEL']}"
</system>

<source>
	@type forward
</source>

<filter **>
	@type record_transformer
	<record>
		@service_name ${tag_parts[0]}
	</record>
</filter>

<filter **>
	@type elasticsearch_genid
	hash_id_key _hash
</filter>

<match **>
	@type elasticsearch_dynamic
	@id elasticsearch-output
	@log_level debug
	id_key _hash
	remove_keys _hash
	hosts "#{ENV['ES_HOSTS']}"
	user "#{ENV['ES_USER']}"
	password "#{ENV['ES_PASS']}"
	type_name fluentd
	logstash_format true
	logstash_prefix fluentd-${tag_parts[0]}
	logstash_dateformat %Y%m
	flush_interval 30s
    request_timeout 15s
    reconnect_on_error true
    reload_on_failure true
    reload_connections false
</match>
